-- BR / 2023 / RG ABIBAICE 
-- Number of students for equity report based on Race and Gender

DECLARE @equity table 
(--gender varchar(40),
 raceDescription varchar(40),
 count INT,
 percentag DECIMAL(10,4)
 );

insert into 
@equity

select distinct
--b.gender,
b.raceDescription,
COUNT(DISTINCT r.studentID) AS 'count',
(COUNT(DISTINCT r.studentID) * 1.0) / (SELECT COUNT(DISTINCT r3.studentID) FROM ala_roster_history r3
                                            JOIN school s3 ON s3.[school-id] = r3.entityID
                                            JOIN ala_allStudents_2223_eoy b3 ON b3.studentID = r3.studentID    --Need to change based on school year
                                            WHERE r3.courseType = 'AP' OR r3.courseType = 'AIC' OR r3.courseName LIKE '%AICE%' OR r3.courseType = 'IB' OR r3.courseName LIKE 'IB%' OR r3.courseName LIKE 'FL PRE-IB%') AS 'percentag'

from
  ala_roster_history r
  join school        s on s.[school-id] = r.entityID
  join ala_allStudents_2223_eoy b on b.studentID = r.studentID      --Need to change based on school year
where
r.courseType = 'AP' or courseType = 'AIC' or courseName like '%AICE%' or courseType = 'IB' or courseName like 'IB%' or courseName like 'FL PRE-IB%'
and r.schoolYear = 2023      -- Need to change based on school year
group by
--b.gender,
b.raceDescription

select *
 from @equity;


--Runs pull to get numbers for student enrollment of IB, AP, AICE broken down my Race & Gender

